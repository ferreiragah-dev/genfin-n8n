{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>GenFin | CartÃµes de CrÃ©dito</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/svg+xml" href="{% static 'accounts/favicon.svg' %}">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
:root{
  --bg:#05070d;
  --bg-grad: radial-gradient(circle at top, #0a1020, #02030a 65%);
  --panel:#0b1224;
  --border:rgba(56,189,248,.15);
  --text:#e5e7eb;
  --muted:#9ca3af;
  --blue:#38bdf8;
  --red:#ef4444;
  --green:#22c55e;
  --yellow:#eab308;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg-grad);color:var(--text)}
.app-shell{display:grid;grid-template-columns:220px 1fr;gap:14px;min-height:100vh;padding:14px}
.sidebar{background:linear-gradient(180deg,#0b1224,#070b18);border:1px solid var(--border);border-radius:16px;padding:14px;display:grid;align-content:start;gap:10px}
.sidebar h4{margin:2px 0 8px;color:#94a3b8;font-size:12px;letter-spacing:.08em;text-transform:uppercase}
.side-link{text-decoration:none;color:#cbd5e1;border:1px solid rgba(56,189,248,.2);background:linear-gradient(180deg,#0b1224,#020617);border-radius:12px;padding:10px 12px;font-size:13px}
.container{padding:20px;display:grid;gap:20px}
.header{background:linear-gradient(180deg,#0b1224,#070b18);border:1px solid var(--border);border-radius:16px;padding:16px 24px;display:flex;justify-content:space-between;align-items:center}
.header-right{display:flex;align-items:center;gap:10px}
.theme-switch{display:flex;align-items:center;gap:4px;border:1px solid var(--border);border-radius:999px;padding:3px;background:linear-gradient(180deg,#0b1224,#020617)}
.theme-btn{border:0;border-radius:999px;padding:6px 10px;font-size:12px;cursor:pointer;background:transparent;color:#cbd5e1}
.theme-btn.active{background:#38bdf8;color:#04111d}
.visibility-btn,.icon-link{width:36px;height:36px;border-radius:10px;border:1px solid var(--border);background:linear-gradient(180deg,#0b1224,#020617);color:#cbd5e1;cursor:pointer;display:flex;align-items:center;justify-content:center;text-decoration:none}
.visibility-btn.active{border-color:rgba(234,179,8,.55);color:#fde68a}
.icon-link.logout{color:#fecaca;border-color:rgba(239,68,68,.35)}
.month-wrap{background:linear-gradient(180deg,#0b1224,#070b18);border:1px solid var(--border);border-radius:16px;padding:12px}
.month-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.month-head small{color:#94a3b8}
.month-bar{display:flex;gap:8px;overflow:auto;padding-bottom:4px}
.month-chip{border:1px solid var(--border);background:#0b1224;color:#cbd5e1;border-radius:999px;padding:7px 12px;font-size:12px;cursor:pointer;white-space:nowrap}
.month-chip.active{background:#38bdf8;color:#04111d}
.cards{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
.card{background:linear-gradient(180deg,#0b1224,#020617);border:1px solid var(--border);border-radius:16px;padding:16px}
.card span{color:var(--muted);font-size:12px}
.card strong{display:block;font-size:22px;margin-top:6px}
.grid{display:grid;grid-template-columns:1fr 1.5fr;gap:20px}
.panel{background:linear-gradient(180deg,#070b18,#020617);border:1px solid var(--border);border-radius:18px;padding:18px}
h3{margin:0 0 12px;font-size:13px;color:#94a3b8;letter-spacing:.08em;text-transform:uppercase}
label{display:block;font-size:12px;color:var(--muted);margin:8px 0 6px}
input,textarea,select{width:100%;background:#0b1224;color:var(--text);border:1px solid rgba(56,189,248,.2);border-radius:10px;padding:10px;font:inherit}
textarea{resize:vertical;min-height:62px}
.actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
button{border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
.btn-primary{background:var(--blue);color:#04111d}
.btn-secondary{background:#1e293b;color:#cbd5e1}
.btn-danger{background:var(--red);color:#fff}
table{width:100%;border-collapse:collapse}
th,td{padding:10px 8px;border-bottom:1px solid rgba(255,255,255,.06);font-size:12px;vertical-align:top}
th{color:#9ca3af;text-align:left}
.row-actions{display:flex;gap:8px}
.message{font-size:12px;color:var(--green);margin-top:8px;min-height:16px}
.list-box{display:grid;gap:8px}
.bill-item{font-size:12px;padding:8px;border:1px dashed rgba(148,163,184,.25);border-radius:10px}
.rule-box{
  background:linear-gradient(180deg,#0b1224,#020617);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  font-size:12px;
  color:#cbd5e1;
  line-height:1.5;
}
.rule-box strong{color:#e2e8f0}
body.values-hidden .card strong, body.values-hidden tbody td:nth-child(4), body.values-hidden .bill-item{filter:blur(6px);user-select:none}
body.theme-light{--bg:#f3f7ff;--bg-grad: radial-gradient(circle at top, #ffffff, #eef4ff 68%);--border:rgba(30,64,175,.16);--text:#0f172a;--muted:#475569;--blue:#2563eb;--green:#16a34a;--red:#dc2626;--yellow:#ca8a04}
body.theme-light .header,body.theme-light .panel,body.theme-light .month-wrap,body.theme-light .card,body.theme-light .sidebar,body.theme-light .side-link,body.theme-light .theme-switch,body.theme-light .visibility-btn,body.theme-light .icon-link,body.theme-light input,body.theme-light textarea,body.theme-light select,body.theme-light .btn-secondary,body.theme-light .theme-btn,body.theme-light .month-chip{background:linear-gradient(180deg,#ffffff,#f8fbff);color:#0f172a}
body.theme-light h3,body.theme-light label,body.theme-light th,body.theme-light .month-head small,body.theme-light #selectedMonthLabel,body.theme-light .card span,body.theme-light .sidebar h4{color:#334155}
body.theme-light .month-head strong{color:#334155 !important}
body.theme-light .month-chip.active,body.theme-light .theme-btn.active{background:#2563eb;color:#fff}
body.theme-light .icon-link.logout{color:#dc2626}
body.theme-light .rule-box{background:linear-gradient(180deg,#ffffff,#f8fbff);color:#334155}
body.theme-light .rule-box strong{color:#0f172a}
@media(max-width:1100px){.grid{grid-template-columns:1fr}.cards{grid-template-columns:1fr 1fr}}
@media(max-width:780px){.app-shell{grid-template-columns:1fr;padding:10px;gap:10px}.sidebar{grid-auto-flow:column;grid-auto-columns:max-content;overflow:auto;align-content:center}.sidebar h4{display:none}.container{padding:12px;gap:12px}.header{flex-direction:column;align-items:flex-start;gap:10px;padding:12px}.header-right{width:100%;flex-wrap:wrap;gap:8px}.panel{padding:12px}.cards{grid-template-columns:1fr}.panel table{display:block;width:100%;overflow-x:auto;white-space:nowrap}}
@media(max-width:520px){.theme-btn{padding:5px 8px;font-size:11px}.visibility-btn,.icon-link{width:32px;height:32px}th,td{font-size:11px;padding:7px 6px}.month-chip{padding:6px 10px;font-size:11px}.card strong{font-size:18px}}
</style>
<script>
let editingCardId = null;
let editingExpenseId = null;
let selectedMonth = new Date().getMonth();
let selectedYear = new Date().getFullYear();

function formatCurrency(value){
  return "R$ " + Number(value || 0).toLocaleString("pt-BR", {minimumFractionDigits:2, maximumFractionDigits:2});
}
function getCsrfToken(){
  const token = document.cookie.split("; ").find((row)=>row.startsWith("csrftoken="));
  return token ? decodeURIComponent(token.split("=")[1]) : "";
}
async function parseError(response, fallback){
  try{ const data = await response.json(); if(data && data.error) return data.error; } catch(_error){}
  return fallback;
}
function setMessage(id, text, isError){
  const el = document.getElementById(id);
  el.textContent = text;
  el.style.color = isError ? "#ef4444" : "#22c55e";
}
function initUiPrefs(){
  const visibilityBtn = document.getElementById("visibilityToggleBtn");
  const dayBtn = document.getElementById("themeDayBtn");
  const nightBtn = document.getElementById("themeNightBtn");
  const applyHidden = (hidden)=>{
    document.body.classList.toggle("values-hidden", hidden);
    visibilityBtn.classList.toggle("active", hidden);
    visibilityBtn.textContent = hidden ? "ðŸ™ˆ" : "ðŸ‘";
  };
  const applyTheme = (mode)=>{
    const isLight = mode === "light";
    document.body.classList.toggle("theme-light", isLight);
    dayBtn.classList.toggle("active", isLight);
    nightBtn.classList.toggle("active", !isLight);
  };
  applyHidden(localStorage.getItem("genfin_values_hidden") === "1");
  applyTheme(localStorage.getItem("genfin_theme_mode") === "light" ? "light" : "dark");
  visibilityBtn.addEventListener("click", ()=>{
    const hidden = !document.body.classList.contains("values-hidden");
    localStorage.setItem("genfin_values_hidden", hidden ? "1" : "0");
    applyHidden(hidden);
  });
  dayBtn.addEventListener("click", ()=>{localStorage.setItem("genfin_theme_mode", "light"); applyTheme("light");});
  nightBtn.addEventListener("click", ()=>{localStorage.setItem("genfin_theme_mode", "dark"); applyTheme("dark");});
}

async function loadCards(){
  const response = await fetch("/api/credit-cards/", {credentials:"same-origin"});
  if(!response.ok) throw new Error("Falha ao carregar cartÃµes");
  const cards = await response.json();
  const tbody = document.getElementById("cardRows");
  const select = document.getElementById("expense_card_id");
  const parentSelect = document.getElementById("card_parent");
  tbody.textContent = "";
  select.textContent = "";
  parentSelect.textContent = "";
  const noneOpt = document.createElement("option");
  noneOpt.value = "";
  noneOpt.textContent = "Nao herdar (limite/fatura proprios)";
  parentSelect.appendChild(noneOpt);
  if(cards.length === 0){
    tbody.innerHTML = '<tr><td colspan="8">Sem cartÃµes cadastrados.</td></tr>';
  }
  cards.forEach((card)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${card.nickname || "-"}</td>
      <td>**** ${card.last4}</td>
      <td>${card.parent_card_last4 ? `**** ${card.parent_card_last4}` : "-"}</td>
      <td>Dia ${card.due_day}</td>
      <td>Dia ${card.closing_day || card.best_purchase_day}</td>
      <td>${formatCurrency(card.limit_amount)}</td>
      <td>${Number(card.miles_per_point || 0).toFixed(2)}</td>
      <td><div class="row-actions"><button class="btn-secondary">Editar</button><button class="btn-danger">Remover</button></div></td>
    `;
    const [editBtn, delBtn] = tr.querySelectorAll("button");
    editBtn.addEventListener("click", ()=>fillCardForm(card));
    delBtn.addEventListener("click", ()=>deleteCard(card.id));
    tbody.appendChild(tr);

    const opt = document.createElement("option");
    opt.value = card.id;
    opt.textContent = `${card.nickname || "CartÃ£o"} (**** ${card.last4})`;
    select.appendChild(opt);
    const parentOpt = document.createElement("option");
    parentOpt.value = card.id;
    parentOpt.textContent = `${card.nickname || "Cartao"} (**** ${card.last4})`;
    parentSelect.appendChild(parentOpt);
  });
}

function fillCardForm(card){
  editingCardId = card.id;
  document.getElementById("card_form_title").textContent = "Editar CartÃ£o";
  document.getElementById("card_nickname").value = card.nickname || "";
  document.getElementById("card_last4").value = card.last4 || "";
  document.getElementById("card_parent").value = card.parent_card_id || "";
  document.getElementById("card_due_day").value = card.due_day;
  document.getElementById("card_closing_day").value = card.closing_day || card.best_purchase_day;
  document.getElementById("card_limit").value = card.limit_amount;
  document.getElementById("card_miles_per_point").value = card.miles_per_point;
  document.getElementById("cancelCardEdit").style.display = "inline-block";
}
function resetCardForm(){
  editingCardId = null;
  document.getElementById("card_form_title").textContent = "Adicionar CartÃ£o";
  document.getElementById("cardForm").reset();
  document.getElementById("cancelCardEdit").style.display = "none";
}
async function deleteCard(cardId){
  if(!confirm("Remover este cartÃ£o e seus gastos?")) return;
  const response = await fetch(`/api/credit-cards/${cardId}/`, {
    method:"DELETE", credentials:"same-origin", headers:{"X-CSRFToken": getCsrfToken()}
  });
  if(!response.ok){
    setMessage("cardMessage", await parseError(response, "Erro ao remover cartÃ£o."), true);
    return;
  }
  setMessage("cardMessage", "CartÃ£o removido.", false);
  if(editingCardId === cardId) resetCardForm();
  await refreshAll();
}
async function submitCardForm(event){
  event.preventDefault();
  const payload = {
    nickname: document.getElementById("card_nickname").value.trim(),
    last4: document.getElementById("card_last4").value.trim(),
    parent_card_id: document.getElementById("card_parent").value || null,
    due_day: document.getElementById("card_due_day").value,
    closing_day: document.getElementById("card_closing_day").value,
    best_purchase_day: document.getElementById("card_closing_day").value,
    limit_amount: document.getElementById("card_limit").value || 0,
    miles_per_point: document.getElementById("card_miles_per_point").value || 1,
  };
  const url = editingCardId ? `/api/credit-cards/${editingCardId}/` : "/api/credit-cards/create/";
  const method = editingCardId ? "PUT" : "POST";
  const response = await fetch(url, {
    method, credentials:"same-origin",
    headers:{"Content-Type":"application/json","X-CSRFToken": getCsrfToken()},
    body: JSON.stringify(payload),
  });
  if(!response.ok){
    setMessage("cardMessage", await parseError(response, "Erro ao salvar cartÃ£o."), true);
    return;
  }
  setMessage("cardMessage", editingCardId ? "CartÃ£o atualizado." : "CartÃ£o criado.", false);
  resetCardForm();
  await refreshAll();
}

async function loadCardExpenses(){
  const response = await fetch("/api/credit-card-expenses/", {credentials:"same-origin"});
  if(!response.ok) throw new Error("Falha ao carregar gastos no cartÃ£o");
  const items = await response.json();
  const tbody = document.getElementById("expenseRows");
  tbody.textContent = "";
  if(items.length === 0){
    tbody.innerHTML = '<tr><td colspan="7">Sem gastos cadastrados.</td></tr>';
  }
  items.forEach((item)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${item.card_name}</td>
      <td>${item.date}</td>
      <td>${item.category}</td>
      <td>${item.description || "-"}</td>
      <td>${formatCurrency(item.amount)}</td>
      <td><div class="row-actions"><button class="btn-secondary">Editar</button><button class="btn-danger">Remover</button></div></td>
    `;
    const [editBtn, delBtn] = tr.querySelectorAll("button");
    editBtn.addEventListener("click", ()=>fillExpenseForm(item));
    delBtn.addEventListener("click", ()=>deleteExpense(item.id));
    tbody.appendChild(tr);
  });
}
function fillExpenseForm(item){
  editingExpenseId = item.id;
  document.getElementById("expense_form_title").textContent = "Editar Gasto no CartÃ£o";
  document.getElementById("expense_card_id").value = item.card_id;
  document.getElementById("expense_date").value = item.date;
  document.getElementById("expense_category").value = item.category;
  document.getElementById("expense_description").value = item.description || "";
  document.getElementById("expense_amount").value = item.amount;
  document.getElementById("cancelExpenseEdit").style.display = "inline-block";
}
function resetExpenseForm(){
  editingExpenseId = null;
  document.getElementById("expense_form_title").textContent = "Adicionar Gasto no CartÃ£o";
  document.getElementById("expenseForm").reset();
  document.getElementById("cancelExpenseEdit").style.display = "none";
}
async function deleteExpense(expenseId){
  if(!confirm("Remover este gasto?")) return;
  const response = await fetch(`/api/credit-card-expenses/${expenseId}/`, {
    method:"DELETE", credentials:"same-origin", headers:{"X-CSRFToken": getCsrfToken()}
  });
  if(!response.ok){
    setMessage("expenseMessage", await parseError(response, "Erro ao remover gasto."), true);
    return;
  }
  setMessage("expenseMessage", "Gasto removido.", false);
  if(editingExpenseId === expenseId) resetExpenseForm();
  await refreshAll();
}
async function submitExpenseForm(event){
  event.preventDefault();
  const payload = {
    card_id: document.getElementById("expense_card_id").value,
    date: document.getElementById("expense_date").value,
    category: document.getElementById("expense_category").value,
    description: document.getElementById("expense_description").value,
    amount: document.getElementById("expense_amount").value,
  };
  const url = editingExpenseId ? `/api/credit-card-expenses/${editingExpenseId}/` : "/api/credit-card-expenses/create/";
  const method = editingExpenseId ? "PUT" : "POST";
  const response = await fetch(url, {
    method, credentials:"same-origin",
    headers:{"Content-Type":"application/json","X-CSRFToken": getCsrfToken()},
    body: JSON.stringify(payload),
  });
  if(!response.ok){
    setMessage("expenseMessage", await parseError(response, "Erro ao salvar gasto."), true);
    return;
  }
  setMessage("expenseMessage", editingExpenseId ? "Gasto atualizado." : "Gasto criado.", false);
  resetExpenseForm();
  await refreshAll();
}

function renderMonthBar(){
  const monthNames = ["JAN","FEV","MAR","ABR","MAI","JUN","JUL","AGO","SET","OUT","NOV","DEZ"];
  const bar = document.getElementById("monthFilterBar");
  bar.textContent = "";
  monthNames.forEach((name, idx)=>{
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "month-chip";
    btn.dataset.month = String(idx);
    btn.textContent = name;
    btn.classList.toggle("active", idx === selectedMonth);
    btn.addEventListener("click", async ()=>{
      selectedMonth = idx;
      renderMonthBar();
      await loadSummary();
    });
    bar.appendChild(btn);
  });
  document.getElementById("selectedMonthLabel").textContent = `Ano ${selectedYear}`;
}

async function loadSummary(){
  const response = await fetch(`/api/credit-cards/summary/?month=${selectedMonth+1}&year=${selectedYear}`, {credentials:"same-origin"});
  if(!response.ok) throw new Error("Falha ao carregar resumo de cartÃµes");
  const data = await response.json();
  document.getElementById("card_count").textContent = String(data.card_count || 0);
  document.getElementById("card_spent").textContent = formatCurrency(data.total_spent || 0);
  document.getElementById("card_usage").textContent = `${Number(data.usage_percent || 0).toFixed(1)}%`;
  document.getElementById("card_miles").textContent = Number(data.estimated_miles || 0).toLocaleString("pt-BR", {maximumFractionDigits:2});

  const billsBox = document.getElementById("billList");
  billsBox.textContent = "";
  if(!data.upcoming_bills || data.upcoming_bills.length === 0){
    billsBox.innerHTML = '<div class="bill-item">Sem faturas geradas para o mÃªs selecionado.</div>';
  } else {
    data.upcoming_bills.forEach((bill)=>{
      const div = document.createElement("div");
      div.className = "bill-item";
      div.textContent = `${bill.date} | ${bill.category} | ${formatCurrency(bill.amount)} | ${bill.is_paid ? "Paga" : "NÃ£o paga"}`;
      billsBox.appendChild(div);
    });
  }
}

async function refreshAll(){
  await loadCards();
  await loadCardExpenses();
  await loadSummary();
}

async function init(){
  initUiPrefs();
  renderMonthBar();
  document.getElementById("cardForm").addEventListener("submit", submitCardForm);
  document.getElementById("expenseForm").addEventListener("submit", submitExpenseForm);
  document.getElementById("cancelCardEdit").addEventListener("click", resetCardForm);
  document.getElementById("cancelExpenseEdit").addEventListener("click", resetExpenseForm);
  try{
    await refreshAll();
  } catch (error){
    console.error(error);
    setMessage("cardMessage", "Erro ao carregar dados de cartÃµes.", true);
  }
}

document.addEventListener("DOMContentLoaded", init);
</script>
</head>
<body>
<div class="app-shell">
  <aside class="sidebar">
    <h4>NavegaÃ§Ã£o</h4>
    <a class="side-link" href="/dashboard/">Dashboard</a>
    <a class="side-link" href="/transactions/">MovimentaÃ§Ãµes</a>
    <a class="side-link" href="/fixed-expenses/">Despesas Fixas</a>
    <a class="side-link" href="/fixed-incomes/">Entradas Fixas</a>
    <a class="side-link" href="/reserves/">Reservas</a>
    <a class="side-link" href="/vehicles/">VeÃ­culos</a>
    <a class="side-link" href="/credit-cards/">CartÃµes</a>
  </aside>

  <div class="container">
    <div class="header">
      <strong>CartÃµes de CrÃ©dito</strong>
      <div class="header-right">
        <div class="theme-switch" aria-label="Alternar tema">
          <button id="themeDayBtn" class="theme-btn" type="button" title="Tema claro">â˜€ Dia</button>
          <button id="themeNightBtn" class="theme-btn active" type="button" title="Tema escuro">ðŸŒ™ Noite</button>
        </div>
        <button id="visibilityToggleBtn" class="visibility-btn" type="button" title="Ocultar valores" aria-label="Ocultar valores">ðŸ‘</button>
        <a href="/dashboard/" class="icon-link" title="NotificaÃ§Ãµes" aria-label="NotificaÃ§Ãµes">ðŸ””</a>
        <a href="/logout/" class="icon-link logout" title="Sair" aria-label="Sair">âŽ‹</a>
      </div>
    </div>

    <div class="month-wrap">
      <div class="month-head">
        <strong style="font-size:13px;color:#94a3b8;letter-spacing:.08em;text-transform:uppercase">Resumo mensal de CartÃµes</strong>
        <small id="selectedMonthLabel"></small>
      </div>
      <div id="monthFilterBar" class="month-bar"></div>
    </div>

    <div class="rule-box">
      <strong>Regra de competÃªncia do cartÃ£o:</strong><br>
      Compras no cartÃ£o seguem o mÃªs da fatura (vencimento), nÃ£o o mÃªs da compra.<br>
      Compras feitas atÃ© o dia de fechamento entram na fatura que fecha no mÃªs atual e aparecem no mÃªs seguinte.<br>
      Compras feitas apÃ³s o fechamento entram na fatura do mÃªs seguinte e aparecem no mÃªs seguinte ao prÃ³ximo.
    </div>

    <div class="cards">
      <div class="card"><span>Total no CartÃ£o</span><strong id="card_spent">R$ 0,00</strong></div>
      <div class="card"><span>Uso de Limite</span><strong id="card_usage">0%</strong></div>
      <div class="card"><span>Milhas Estimadas</span><strong id="card_miles">0</strong></div>
      <div class="card"><span>CartÃµes Cadastrados</span><strong id="card_count">0</strong></div>
    </div>

    <div class="grid">
      <div class="panel">
        <h3 id="card_form_title">Adicionar CartÃ£o</h3>
        <form id="cardForm">
          <label for="card_nickname">Nome do CartÃ£o</label>
          <input id="card_nickname" type="text" maxlength="80" placeholder="Ex.: Nubank, C6 Black">

          <label for="card_last4">Ãšltimos 4 nÃºmeros</label>
          <input id="card_last4" type="text" maxlength="4" required>

          <label for="card_parent">Herdar limite/fatura de</label>
          <select id="card_parent"></select>

          <label for="card_due_day">Dia do vencimento</label>
          <input id="card_due_day" type="number" min="1" max="31" required>

          <label for="card_closing_day">Dia de fechamento da fatura</label>
          <input id="card_closing_day" type="number" min="1" max="31" required>

          <label for="card_limit">Limite</label>
          <input id="card_limit" type="number" min="0" step="0.01">

          <label for="card_miles_per_point">Milhas por ponto</label>
          <input id="card_miles_per_point" type="number" min="0" step="0.01" value="1">

          <div class="actions">
            <button type="submit" class="btn-primary">Salvar CartÃ£o</button>
            <button type="button" id="cancelCardEdit" class="btn-secondary" style="display:none">Cancelar</button>
          </div>
        </form>
        <div id="cardMessage" class="message"></div>
      </div>

      <div class="panel">
        <h3>CartÃµes Cadastrados</h3>
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>Final</th>
              <th>Herdado de</th>
              <th>Venc.</th>
              <th>Fechamento</th>
              <th>Limite</th>
              <th>Milhas/ponto</th>
              <th>AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody id="cardRows"></tbody>
        </table>
      </div>
    </div>

    <div class="grid">
      <div class="panel">
        <h3 id="expense_form_title">Adicionar Gasto no CartÃ£o</h3>
        <form id="expenseForm">
          <label for="expense_card_id">CartÃ£o</label>
          <select id="expense_card_id" required></select>

          <label for="expense_date">Data do gasto</label>
          <input id="expense_date" type="date" required>

          <label for="expense_category">Categoria</label>
          <input id="expense_category" type="text" maxlength="80" required>

          <label for="expense_description">DescriÃ§Ã£o</label>
          <textarea id="expense_description"></textarea>

          <label for="expense_amount">Valor</label>
          <input id="expense_amount" type="number" min="0" step="0.01" required>

          <div class="actions">
            <button type="submit" class="btn-primary">Salvar Gasto</button>
            <button type="button" id="cancelExpenseEdit" class="btn-secondary" style="display:none">Cancelar</button>
          </div>
        </form>
        <div id="expenseMessage" class="message"></div>
      </div>

      <div class="panel">
        <h3>Gastos no CartÃ£o</h3>
        <table>
          <thead>
            <tr>
              <th>CartÃ£o</th>
              <th>Data</th>
              <th>Categoria</th>
              <th>DescriÃ§Ã£o</th>
              <th>Valor</th>
              <th>AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody id="expenseRows"></tbody>
        </table>
        <h3 style="margin-top:16px">Faturas Geradas em Despesas Fixas (mÃªs selecionado)</h3>
        <div id="billList" class="list-box"></div>
      </div>
    </div>
  </div>
</div>
</body>
</html>

