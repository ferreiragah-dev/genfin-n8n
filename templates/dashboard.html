<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>GenFin | Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg: #0b1220;
  --panel: #121a2f;
  --border: #1e2a4a;
  --text: #e5e7eb;
  --muted: #94a3b8;
  --green: #22c55e;
  --red: #ef4444;
  --yellow: #facc15;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: Inter, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  height: 100vh;
}

/* SIDEBAR */
.sidebar {
  width: 80px;
  background: #070d1a;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px 0;
  gap: 20px;
}

.sidebar div {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  background: var(--panel);
  display: flex;
  align-items: center;
  justify-content: center;
}

/* MAIN */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* HEADER */
.header {
  padding: 20px 32px;
  display: flex;
  align-items: center;
}

.avatar {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: linear-gradient(135deg, #38bdf8, #22c55e);
  margin-right: 12px;
}

/* CONTENT */
.content {
  padding: 24px 32px;
  overflow-y: auto;
}

/* CARDS */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.card {
  background: var(--panel);
  border-radius: 16px;
  padding: 18px;
  border: 1px solid var(--border);
}

.card h4 {
  margin: 0;
  font-size: 14px;
  color: var(--muted);
}

.card p {
  margin-top: 10px;
  font-size: 26px;
  font-weight: 600;
}

.green { color: var(--green); }
.red { color: var(--red); }
.yellow { color: var(--yellow); }

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px,1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.panel {
  background: var(--panel);
  border-radius: 16px;
  padding: 18px;
  border: 1px solid var(--border);
}

.panel h3 {
  margin: 0 0 12px;
  font-size: 15px;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid var(--border);
  font-size: 14px;
}

th {
  color: var(--muted);
  text-align: left;
}

.badge-receita { color: var(--green); font-weight: 600; }
.badge-despesa { color: var(--red); font-weight: 600; }

@media (max-width: 900px) {
  .grid { grid-template-columns: 1fr; }
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <div>üè†</div>
  <div>üìä</div>
  <div>üí≥</div>
  <div>‚öôÔ∏è</div>
</div>

<!-- MAIN -->
<div class="main">

  <!-- HEADER -->
  <div class="header">
    <div class="avatar"></div>
    <div>
      <div style="color:var(--muted);font-size:13px">Bem-vindo</div>
      <strong>Usu√°rio GenFin</strong>
    </div>
  </div>

  <!-- CONTENT -->
  <div class="content">

    <!-- CARDS -->
    <div class="cards">
      <div class="card">
        <h4>Saldo Total</h4>
        <p class="yellow" id="saldo">R$ 0</p>
      </div>
      <div class="card">
        <h4>Total de Receitas</h4>
        <p class="green" id="receita">R$ 0</p>
      </div>
      <div class="card">
        <h4>Total de Despesas</h4>
        <p class="red" id="despesa">R$ 0</p>
      </div>
    </div>

    <!-- COMPARATIVOS -->
    <div class="grid">
      <div class="panel">
        <h3>Hoje</h3>
        <canvas id="dailyChart"></canvas>
      </div>
      <div class="panel">
        <h3>√öltimos 7 dias</h3>
        <canvas id="weeklyChart"></canvas>
      </div>
      <div class="panel">
        <h3>√öltimos 30 dias</h3>
        <canvas id="monthlyChart"></canvas>
      </div>
    </div>

    <!-- GR√ÅFICOS -->
    <div class="grid">
      <div class="panel">
        <h3>Evolu√ß√£o do Saldo</h3>
        <canvas id="lineChart"></canvas>
      </div>
      <div class="panel">
        <h3>Despesas por Categoria</h3>
        <canvas id="donutChart"></canvas>
      </div>
    </div>

    <!-- TRANSA√á√ïES -->
    <div class="panel">
      <h3>Transa√ß√µes Recentes</h3>
      <table>
        <thead>
          <tr>
            <th>Data</th>
            <th>Categoria</th>
            <th>Tipo</th>
            <th>Valor</th>
          </tr>
        </thead>
        <tbody id="entries"></tbody>
      </table>
    </div>

  </div>
</div>

<script>
async function loadDashboard() {
  const dash = await fetch("/api/dashboard/", { credentials: "same-origin" }).then(r => r.json());
  const entries = await fetch("/api/entries/", { credentials: "same-origin" }).then(r => r.json());
  const cats = await fetch("/api/dashboard/categories/", { credentials: "same-origin" }).then(r => r.json());

  document.getElementById("saldo").innerText = "R$ " + dash.saldo;
  document.getElementById("receita").innerText = "R$ " + dash.total_receita;
  document.getElementById("despesa").innerText = "R$ " + dash.total_despesa;

  // TABELA
  const tbody = document.getElementById("entries");
  tbody.innerHTML = "";
  entries.slice(0,8).forEach(e => {
    tbody.innerHTML += `
      <tr>
        <td>${e.date}</td>
        <td>${e.category}</td>
        <td class="${e.entry_type === "RECEITA" ? "badge-receita" : "badge-despesa"}">
          ${e.entry_type === "RECEITA" ? "Receita" : "Despesa"}
        </td>
        <td>R$ ${e.amount}</td>
      </tr>
    `;
  });

  function bar(id) {
    new Chart(document.getElementById(id), {
      type: "bar",
      data: {
        labels: ["Receitas", "Despesas"],
        datasets: [{
          data: [dash.total_receita, dash.total_despesa],
          backgroundColor: ["#22c55e", "#ef4444"]
        }]
      },
      options: { plugins: { legend: { display: false } } }
    });
  }

  bar("dailyChart");
  bar("weeklyChart");
  bar("monthlyChart");

  new Chart(document.getElementById("lineChart"), {
    type: "line",
    data: {
      labels: ["Jan","Fev","Mar","Abr","Mai","Jun"],
      datasets: [{
        label: "Saldo",
        data: [2000,3000,4200,4800, dash.saldo],
        borderColor: "#facc15",
        tension: .4,
        fill: true
      }]
    }
  });

  new Chart(document.getElementById("donutChart"), {
    type: "doughnut",
    data: {
      labels: cats.map(c => c.category),
      datasets: [{
        data: cats.map(c => c.total),
        backgroundColor: ["#ef4444","#f97316","#eab308","#22c55e","#38bdf8"]
      }]
    }
  });
}

loadDashboard();
</script>

</body>
</html>
